{"remainingRequest":"D:\\termination project\\front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\termination project\\front\\src\\views\\teacher\\MarkManage.vue?vue&type=style&index=0&id=6b902f19&scoped=true&lang=scss&","dependencies":[{"path":"D:\\termination project\\front\\src\\views\\teacher\\MarkManage.vue","mtime":1683865723986},{"path":"D:\\termination project\\front\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\termination project\\front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\termination project\\front\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\termination project\\front\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\termination project\\front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\termination project\\front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpAaW1wb3J0ICIuLi8uLi9hc3NldHMvY3NzL3RlYWNoZXIvbWFya01hbmFnZSI7DQo="},{"version":3,"sources":["MarkManage.vue"],"names":[],"mappings":";AAyKA","file":"MarkManage.vue","sourceRoot":"src/views/teacher","sourcesContent":["<template>\r\n  <el-container>\r\n    <el-header>\r\n      <!--操作的下拉框-->\r\n      <el-select @change=\"operation\" clearable v-model=\"queryInfo.examId\"\r\n                 placeholder=\"Please select a examination\" style=\"margin-bottom: 25px;\">\r\n        <el-option v-for=\"(item,index) in allExamInfo\" :key=\"index\" :label=\"item.examName\"\r\n                   :value=\"parseInt(item.examId)\">\r\n          <span style=\"float: left\">{{ item.examName }}</span>\r\n        </el-option>\r\n      </el-select>\r\n\r\n    </el-header>\r\n\r\n    <el-main>\r\n      <el-table\r\n        ref=\"questionTable\"\r\n        highlight-current-row\r\n        v-loading=\"loading\"\r\n        :border=\"true\"\r\n        :data=\"examRecords\"\r\n        tooltip-effect=\"dark\"\r\n        style=\"width: 100%;\">\r\n\r\n        <el-table-column align=\"center\" prop=\"examName\" label=\"Examination name\"></el-table-column>\r\n\r\n        <el-table-column align=\"center\" prop=\"examTime\" label=\"Examination time\"></el-table-column>\r\n\r\n        <el-table-column align=\"center\" prop=\"trueName\" label=\"grader\"></el-table-column>\r\n\r\n        <el-table-column align=\"center\" prop=\"logicScore\" label=\"Logic question score\"></el-table-column>\r\n\r\n        <el-table-column align=\"center\" label=\"Scored?\">\r\n          <template slot-scope=\"scope\">\r\n            <span>{{ scope.row.totalScore === null ? 'No' : 'Yes' }}</span>\r\n          </template> \r\n        </el-table-column>\r\n\r\n        <el-table-column align=\"center\" label=\"Total score\">\r\n          <template slot-scope=\"scope\">\r\n            <span>{{ scope.row.totalScore === null ? 0 : scope.row.totalScore }}</span>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column align=\"center\" label=\"Operation\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button :type=\"checkMarkButtonNeedShow(scope.row) ? 'primary' : 'warning'\" icon=\"el-icon-view\" size=\"small\"\r\n                       :disabled=\"!checkMarkButtonNeedShow(scope.row)\"\r\n                       @click=\"$router.push('/markExam/' + scope.row.recordId)\">\r\n              {{ checkMarkButtonNeedShow(scope.row) ? 'Score' : 'Scored' }}\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <!--分页-->\r\n      <el-pagination style=\"margin-top: 25px\"\r\n                     @size-change=\"handleSizeChange\"\r\n                     @current-change=\"handleCurrentChange\"\r\n                     :current-page=\"queryInfo.pageNo\"\r\n                     :page-sizes=\"[10, 20, 30, 50]\"\r\n                     :page-size=\"queryInfo.pageSize\"\r\n                     layout=\"total, sizes, prev, pager, next, jumper\"\r\n                     :total=\"total\">\r\n      </el-pagination>\r\n    </el-main>\r\n  </el-container>\r\n</template>\r\n\r\n<script>\r\nimport exam from '@/api/exam'\r\nimport user from '@/api/user'\r\nimport constants from '@/utils/constants'\r\n\r\nexport default {\r\n  name: 'MarkManage',\r\n  data() {\r\n    return {\r\n      queryInfo: {\r\n        pageNo: 1,\r\n        pageSize: 10\r\n      },\r\n      //考试记录\r\n      examRecords: [],\r\n      //表格数据加载\r\n      loading: true,\r\n      //所有考试信息\r\n      allExamInfo: [],\r\n      //总数\r\n      total: 0\r\n    }\r\n  },\r\n  created() {\r\n    this.getExamRecords()\r\n    this.getAllExamInfo()\r\n  },\r\n  methods: {\r\n    async getExamRecords() {\r\n      await exam.getExamRecord(this.queryInfo).then(async resp => {\r\n        if (resp.code === 200) {\r\n          await this.getAllExamInfo()\r\n          let userIds = []\r\n          resp.data.data.forEach(item => {\r\n            if (userIds.every(id => id !== item.userId)) {\r\n              userIds.push(item.userId)\r\n            }\r\n          })\r\n          let userInfo = []\r\n          await user.getUserByIds({'userIds': userIds.join(',')}).then(resp => {\r\n            if (resp.code === 200) {\r\n              userInfo = resp.data\r\n            }\r\n          })\r\n          resp.data.data.forEach(item => {\r\n            const currentUserInfo = userInfo.find(u => u.id === item.userId)\r\n            item.trueName = currentUserInfo?.trueName\r\n          })\r\n          this.examRecords = resp.data.data\r\n          // 当examRecords和examInfo准备好之后处理\r\n          this.setExamName()\r\n          this.total = resp.data.total\r\n          this.loading = false\r\n        }\r\n      })\r\n    },\r\n    getAllExamInfo() {\r\n      exam.allExamInfo().then((resp) => {\r\n        if (resp.code === 200) {\r\n          this.allExamInfo = resp.data\r\n        }\r\n      })\r\n    },\r\n    operation(v) {\r\n      if (v === '') this.queryInfo.examId = null\r\n      this.getExamRecords()\r\n    },\r\n    setExamName() {\r\n      this.examRecords.forEach(item => {\r\n        this.allExamInfo.forEach(i2 => {\r\n          if (item.examId === i2.examId) {\r\n            this.$set(item, 'examName', i2.examName)\r\n          }\r\n        })\r\n        if (!item.examName) {\r\n          this.$set(item, 'examName', constants.defaultExamName)\r\n        }\r\n      })\r\n    },\r\n    //分页页面大小改变\r\n    handleSizeChange(val) {\r\n      this.queryInfo.pageSize = val\r\n      this.getExamRecords()\r\n    },\r\n    //分页插件的页数\r\n    handleCurrentChange(val) {\r\n      this.queryInfo.pageNo = val\r\n      this.getExamRecords()\r\n    },\r\n    //检查批阅按钮是否展示\r\n    checkMarkButtonNeedShow(record) {\r\n      return record.totalScore === null && this.allExamInfo\r\n        .map(examInfo => examInfo.examId)\r\n        .includes(record.examId)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import \"../../assets/css/teacher/markManage\";\r\n</style>\r\n"]}]}