{"remainingRequest":"D:\\termination project\\front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\termination project\\front\\src\\views\\teacher\\MarkManage.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\termination project\\front\\src\\views\\teacher\\MarkManage.vue","mtime":1683865723986},{"path":"D:\\termination project\\front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\termination project\\front\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\termination project\\front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\termination project\\front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgZXhhbSBmcm9tICdAL2FwaS9leGFtJw0KaW1wb3J0IHVzZXIgZnJvbSAnQC9hcGkvdXNlcicNCmltcG9ydCBjb25zdGFudHMgZnJvbSAnQC91dGlscy9jb25zdGFudHMnDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ01hcmtNYW5hZ2UnLA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBxdWVyeUluZm86IHsNCiAgICAgICAgcGFnZU5vOiAxLA0KICAgICAgICBwYWdlU2l6ZTogMTANCiAgICAgIH0sDQogICAgICAvL+iAg+ivleiusOW9lQ0KICAgICAgZXhhbVJlY29yZHM6IFtdLA0KICAgICAgLy/ooajmoLzmlbDmja7liqDovb0NCiAgICAgIGxvYWRpbmc6IHRydWUsDQogICAgICAvL+aJgOacieiAg+ivleS/oeaBrw0KICAgICAgYWxsRXhhbUluZm86IFtdLA0KICAgICAgLy/mgLvmlbANCiAgICAgIHRvdGFsOiAwDQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuZ2V0RXhhbVJlY29yZHMoKQ0KICAgIHRoaXMuZ2V0QWxsRXhhbUluZm8oKQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgYXN5bmMgZ2V0RXhhbVJlY29yZHMoKSB7DQogICAgICBhd2FpdCBleGFtLmdldEV4YW1SZWNvcmQodGhpcy5xdWVyeUluZm8pLnRoZW4oYXN5bmMgcmVzcCA9PiB7DQogICAgICAgIGlmIChyZXNwLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgIGF3YWl0IHRoaXMuZ2V0QWxsRXhhbUluZm8oKQ0KICAgICAgICAgIGxldCB1c2VySWRzID0gW10NCiAgICAgICAgICByZXNwLmRhdGEuZGF0YS5mb3JFYWNoKGl0ZW0gPT4gew0KICAgICAgICAgICAgaWYgKHVzZXJJZHMuZXZlcnkoaWQgPT4gaWQgIT09IGl0ZW0udXNlcklkKSkgew0KICAgICAgICAgICAgICB1c2VySWRzLnB1c2goaXRlbS51c2VySWQpDQogICAgICAgICAgICB9DQogICAgICAgICAgfSkNCiAgICAgICAgICBsZXQgdXNlckluZm8gPSBbXQ0KICAgICAgICAgIGF3YWl0IHVzZXIuZ2V0VXNlckJ5SWRzKHsndXNlcklkcyc6IHVzZXJJZHMuam9pbignLCcpfSkudGhlbihyZXNwID0+IHsNCiAgICAgICAgICAgIGlmIChyZXNwLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgICAgICB1c2VySW5mbyA9IHJlc3AuZGF0YQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pDQogICAgICAgICAgcmVzcC5kYXRhLmRhdGEuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VySW5mbyA9IHVzZXJJbmZvLmZpbmQodSA9PiB1LmlkID09PSBpdGVtLnVzZXJJZCkNCiAgICAgICAgICAgIGl0ZW0udHJ1ZU5hbWUgPSBjdXJyZW50VXNlckluZm8/LnRydWVOYW1lDQogICAgICAgICAgfSkNCiAgICAgICAgICB0aGlzLmV4YW1SZWNvcmRzID0gcmVzcC5kYXRhLmRhdGENCiAgICAgICAgICAvLyDlvZNleGFtUmVjb3Jkc+WSjGV4YW1JbmZv5YeG5aSH5aW95LmL5ZCO5aSE55CGDQogICAgICAgICAgdGhpcy5zZXRFeGFtTmFtZSgpDQogICAgICAgICAgdGhpcy50b3RhbCA9IHJlc3AuZGF0YS50b3RhbA0KICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlDQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfSwNCiAgICBnZXRBbGxFeGFtSW5mbygpIHsNCiAgICAgIGV4YW0uYWxsRXhhbUluZm8oKS50aGVuKChyZXNwKSA9PiB7DQogICAgICAgIGlmIChyZXNwLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgIHRoaXMuYWxsRXhhbUluZm8gPSByZXNwLmRhdGENCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIG9wZXJhdGlvbih2KSB7DQogICAgICBpZiAodiA9PT0gJycpIHRoaXMucXVlcnlJbmZvLmV4YW1JZCA9IG51bGwNCiAgICAgIHRoaXMuZ2V0RXhhbVJlY29yZHMoKQ0KICAgIH0sDQogICAgc2V0RXhhbU5hbWUoKSB7DQogICAgICB0aGlzLmV4YW1SZWNvcmRzLmZvckVhY2goaXRlbSA9PiB7DQogICAgICAgIHRoaXMuYWxsRXhhbUluZm8uZm9yRWFjaChpMiA9PiB7DQogICAgICAgICAgaWYgKGl0ZW0uZXhhbUlkID09PSBpMi5leGFtSWQpIHsNCiAgICAgICAgICAgIHRoaXMuJHNldChpdGVtLCAnZXhhbU5hbWUnLCBpMi5leGFtTmFtZSkNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIGlmICghaXRlbS5leGFtTmFtZSkgew0KICAgICAgICAgIHRoaXMuJHNldChpdGVtLCAnZXhhbU5hbWUnLCBjb25zdGFudHMuZGVmYXVsdEV4YW1OYW1lKQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgLy/liIbpobXpobXpnaLlpKflsI/mlLnlj5gNCiAgICBoYW5kbGVTaXplQ2hhbmdlKHZhbCkgew0KICAgICAgdGhpcy5xdWVyeUluZm8ucGFnZVNpemUgPSB2YWwNCiAgICAgIHRoaXMuZ2V0RXhhbVJlY29yZHMoKQ0KICAgIH0sDQogICAgLy/liIbpobXmj5Lku7bnmoTpobXmlbANCiAgICBoYW5kbGVDdXJyZW50Q2hhbmdlKHZhbCkgew0KICAgICAgdGhpcy5xdWVyeUluZm8ucGFnZU5vID0gdmFsDQogICAgICB0aGlzLmdldEV4YW1SZWNvcmRzKCkNCiAgICB9LA0KICAgIC8v5qOA5p+l5om56ZiF5oyJ6ZKu5piv5ZCm5bGV56S6DQogICAgY2hlY2tNYXJrQnV0dG9uTmVlZFNob3cocmVjb3JkKSB7DQogICAgICByZXR1cm4gcmVjb3JkLnRvdGFsU2NvcmUgPT09IG51bGwgJiYgdGhpcy5hbGxFeGFtSW5mbw0KICAgICAgICAubWFwKGV4YW1JbmZvID0+IGV4YW1JbmZvLmV4YW1JZCkNCiAgICAgICAgLmluY2x1ZGVzKHJlY29yZC5leGFtSWQpDQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["MarkManage.vue"],"names":[],"mappings":";AAsEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"MarkManage.vue","sourceRoot":"src/views/teacher","sourcesContent":["<template>\r\n  <el-container>\r\n    <el-header>\r\n      <!--操作的下拉框-->\r\n      <el-select @change=\"operation\" clearable v-model=\"queryInfo.examId\"\r\n                 placeholder=\"Please select a examination\" style=\"margin-bottom: 25px;\">\r\n        <el-option v-for=\"(item,index) in allExamInfo\" :key=\"index\" :label=\"item.examName\"\r\n                   :value=\"parseInt(item.examId)\">\r\n          <span style=\"float: left\">{{ item.examName }}</span>\r\n        </el-option>\r\n      </el-select>\r\n\r\n    </el-header>\r\n\r\n    <el-main>\r\n      <el-table\r\n        ref=\"questionTable\"\r\n        highlight-current-row\r\n        v-loading=\"loading\"\r\n        :border=\"true\"\r\n        :data=\"examRecords\"\r\n        tooltip-effect=\"dark\"\r\n        style=\"width: 100%;\">\r\n\r\n        <el-table-column align=\"center\" prop=\"examName\" label=\"Examination name\"></el-table-column>\r\n\r\n        <el-table-column align=\"center\" prop=\"examTime\" label=\"Examination time\"></el-table-column>\r\n\r\n        <el-table-column align=\"center\" prop=\"trueName\" label=\"grader\"></el-table-column>\r\n\r\n        <el-table-column align=\"center\" prop=\"logicScore\" label=\"Logic question score\"></el-table-column>\r\n\r\n        <el-table-column align=\"center\" label=\"Scored?\">\r\n          <template slot-scope=\"scope\">\r\n            <span>{{ scope.row.totalScore === null ? 'No' : 'Yes' }}</span>\r\n          </template> \r\n        </el-table-column>\r\n\r\n        <el-table-column align=\"center\" label=\"Total score\">\r\n          <template slot-scope=\"scope\">\r\n            <span>{{ scope.row.totalScore === null ? 0 : scope.row.totalScore }}</span>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column align=\"center\" label=\"Operation\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button :type=\"checkMarkButtonNeedShow(scope.row) ? 'primary' : 'warning'\" icon=\"el-icon-view\" size=\"small\"\r\n                       :disabled=\"!checkMarkButtonNeedShow(scope.row)\"\r\n                       @click=\"$router.push('/markExam/' + scope.row.recordId)\">\r\n              {{ checkMarkButtonNeedShow(scope.row) ? 'Score' : 'Scored' }}\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <!--分页-->\r\n      <el-pagination style=\"margin-top: 25px\"\r\n                     @size-change=\"handleSizeChange\"\r\n                     @current-change=\"handleCurrentChange\"\r\n                     :current-page=\"queryInfo.pageNo\"\r\n                     :page-sizes=\"[10, 20, 30, 50]\"\r\n                     :page-size=\"queryInfo.pageSize\"\r\n                     layout=\"total, sizes, prev, pager, next, jumper\"\r\n                     :total=\"total\">\r\n      </el-pagination>\r\n    </el-main>\r\n  </el-container>\r\n</template>\r\n\r\n<script>\r\nimport exam from '@/api/exam'\r\nimport user from '@/api/user'\r\nimport constants from '@/utils/constants'\r\n\r\nexport default {\r\n  name: 'MarkManage',\r\n  data() {\r\n    return {\r\n      queryInfo: {\r\n        pageNo: 1,\r\n        pageSize: 10\r\n      },\r\n      //考试记录\r\n      examRecords: [],\r\n      //表格数据加载\r\n      loading: true,\r\n      //所有考试信息\r\n      allExamInfo: [],\r\n      //总数\r\n      total: 0\r\n    }\r\n  },\r\n  created() {\r\n    this.getExamRecords()\r\n    this.getAllExamInfo()\r\n  },\r\n  methods: {\r\n    async getExamRecords() {\r\n      await exam.getExamRecord(this.queryInfo).then(async resp => {\r\n        if (resp.code === 200) {\r\n          await this.getAllExamInfo()\r\n          let userIds = []\r\n          resp.data.data.forEach(item => {\r\n            if (userIds.every(id => id !== item.userId)) {\r\n              userIds.push(item.userId)\r\n            }\r\n          })\r\n          let userInfo = []\r\n          await user.getUserByIds({'userIds': userIds.join(',')}).then(resp => {\r\n            if (resp.code === 200) {\r\n              userInfo = resp.data\r\n            }\r\n          })\r\n          resp.data.data.forEach(item => {\r\n            const currentUserInfo = userInfo.find(u => u.id === item.userId)\r\n            item.trueName = currentUserInfo?.trueName\r\n          })\r\n          this.examRecords = resp.data.data\r\n          // 当examRecords和examInfo准备好之后处理\r\n          this.setExamName()\r\n          this.total = resp.data.total\r\n          this.loading = false\r\n        }\r\n      })\r\n    },\r\n    getAllExamInfo() {\r\n      exam.allExamInfo().then((resp) => {\r\n        if (resp.code === 200) {\r\n          this.allExamInfo = resp.data\r\n        }\r\n      })\r\n    },\r\n    operation(v) {\r\n      if (v === '') this.queryInfo.examId = null\r\n      this.getExamRecords()\r\n    },\r\n    setExamName() {\r\n      this.examRecords.forEach(item => {\r\n        this.allExamInfo.forEach(i2 => {\r\n          if (item.examId === i2.examId) {\r\n            this.$set(item, 'examName', i2.examName)\r\n          }\r\n        })\r\n        if (!item.examName) {\r\n          this.$set(item, 'examName', constants.defaultExamName)\r\n        }\r\n      })\r\n    },\r\n    //分页页面大小改变\r\n    handleSizeChange(val) {\r\n      this.queryInfo.pageSize = val\r\n      this.getExamRecords()\r\n    },\r\n    //分页插件的页数\r\n    handleCurrentChange(val) {\r\n      this.queryInfo.pageNo = val\r\n      this.getExamRecords()\r\n    },\r\n    //检查批阅按钮是否展示\r\n    checkMarkButtonNeedShow(record) {\r\n      return record.totalScore === null && this.allExamInfo\r\n        .map(examInfo => examInfo.examId)\r\n        .includes(record.examId)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import \"../../assets/css/teacher/markManage\";\r\n</style>\r\n"]}]}